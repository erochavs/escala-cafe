<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Cloud CafÃ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="p-4 md:p-10 text-slate-200">

    <div x-data="sistemaAdmin" x-cloak x-show="autenticado" class="max-w-2xl mx-auto space-y-8">
        
        <header class="flex justify-between items-end border-b border-slate-800 pb-6">
            <div>
                <h1 class="text-3xl font-black text-white italic tracking-tighter">ADMIN <span class="text-amber-500">CLOUD</span></h1>
                <p class="text-slate-500 text-[10px] font-bold uppercase tracking-[0.2em] mt-1">GestÃ£o de Fila â€¢ CafÃ© dos Pais</p>
            </div>
            <a href="index.html" class="text-[10px] bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full border border-slate-700 transition-all font-bold uppercase tracking-widest">Sair</a>
        </header>

        <section class="glass rounded-[2rem] p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold text-white flex items-center">
                    <span class="mr-2">ðŸ‘¥</span> Ordem da Fila
                </h2>
                <button @click="carregarDados()" class="text-[10px] text-amber-500 font-bold hover:underline">ðŸ”„ SINCRONIZAR</button>
            </div>
            
            <div class="flex gap-3 mb-8">
                <input type="text" x-model="novoNome" @keyup.enter="adicionarPessoa()"
                       placeholder="Nome do colega..." 
                       class="flex-1 bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-amber-500 transition-all text-white shadow-inner text-sm">
                <button @click="adicionarPessoa()" 
                        class="bg-amber-600 hover:bg-amber-500 text-slate-900 font-black px-6 py-3 rounded-xl transition-all active:scale-95 shadow-lg shadow-amber-600/20 text-sm">
                    ADD
                </button>
            </div>

            <div class="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                <template x-for="(pessoa, i) in listaEquipe" :key="pessoa.id">
                    <div class="group flex justify-between items-center bg-slate-800/40 p-4 rounded-2xl border border-slate-700/50 hover:border-amber-500/30 transition-all">
                        <div class="flex items-center">
                            <span class="text-slate-500 font-mono text-xs mr-4" x-text="(i + 1).toString().padStart(2, '0')"></span>
                            <span class="font-bold text-slate-200 text-lg" x-text="pessoa.nome"></span>
                        </div>
                        <div class="flex items-center gap-1">
                            <button @click="mover(i, -1)" class="p-2 text-slate-500 hover:text-amber-500 transition-colors" title="Subir">â–²</button>
                            <button @click="mover(i, 1)" class="p-2 text-slate-500 hover:text-amber-500 transition-colors" title="Descer">â–¼</button>
                            <button @click="removerPessoa(pessoa.id)" class="ml-2 p-2 text-slate-500 hover:text-red-500 transition-all">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <section class="glass rounded-[2rem] p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold text-white flex items-center">
                    <span class="mr-2">ðŸ“œ</span> HistÃ³rico de Registros
                </h2>
                <button @click="adicionarRegistroManual()" class="text-[10px] bg-emerald-900/30 text-emerald-500 border border-emerald-500/30 px-3 py-1 rounded-full font-bold hover:bg-emerald-500 hover:text-white transition-all">NOVO LOG</button>
            </div>

            <div class="space-y-3 custom-scrollbar max-h-[300px] overflow-y-auto pr-2">
                <template x-for="log in historico" :key="log.id">
                    <div class="flex justify-between items-center bg-slate-900/30 p-4 rounded-xl border border-slate-800/50 group">
                        <div>
                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-tighter" x-text="log.data"></p>
                            <p class="font-bold text-amber-500" x-text="log.pessoa"></p>
                        </div>
                        <button @click="removerLog(log.id)" class="opacity-0 group-hover:opacity-100 text-slate-700 hover:text-red-500 transition-all">âœ•</button>
                    </div>
                </template>
                <template x-if="historico.length === 0">
                    <p class="text-center py-4 text-slate-600 italic text-sm">Nenhum registro encontrado.</p>
                </template>
            </div>
        </section>
    </div>

    <script>
        const SUPABASE_URL = 'https://ruduyqqawoobctarrjkh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1ZHV5cXFhd29vYmN0YXJyamtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NTE0NzQsImV4cCI6MjA4NTEyNzQ3NH0.-uSYNlG5DByz0UwA5guCYIIY_MXE24QmP-7QJyFAHiI';
        
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        document.addEventListener('alpine:init', () => {
            Alpine.data('sistemaAdmin', () => ({
                listaEquipe: [],
                historico: [],
                novoNome: '',
                autenticado: false,
                senhaMestra: 'admin123', // Mude aqui a sua senha

                async init() {
                    this.verificarAcesso();
                },

                verificarAcesso() {
                    const pass = prompt("Senha de Admin:");
                    if (pass === this.senhaMestra) {
                        this.autenticado = true;
                        this.carregarDados();
                    } else {
                        alert("Acesso negado!");
                        window.location.href = 'index.html';
                    }
                },

                async carregarDados() {
                    const { data: equipe } = await sb.from('cafe_equipe').select('*').order('ordem');
                    const { data: hist } = await sb.from('cafe_historico').select('*').order('id', { ascending: false });
                    this.listaEquipe = equipe || [];
                    this.historico = hist || [];
                },

                async adicionarPessoa() {
                    if (!this.novoNome.trim()) return;
                    await sb.from('cafe_equipe').insert([{ nome: this.novoNome.trim(), ordem: this.listaEquipe.length }]);
                    this.novoNome = '';
                    await this.carregarDados();
                },

                async removerPessoa(id) {
                    if(!confirm('Remover da fila?')) return;
                    await sb.from('cafe_equipe').delete().eq('id', id);
                    await this.reordenarBanco();
                },

                async mover(index, direcao) {
                    const novaPos = index + direcao;
                    if (novaPos < 0 || novaPos >= this.listaEquipe.length) return;
                    const item = this.listaEquipe.splice(index, 1)[0];
                    this.listaEquipe.splice(novaPos, 0, item);
                    await this.reordenarBanco();
                },

                async reordenarBanco() {
                    const updates = this.listaEquipe.map((p, i) => ({
                        id: p.id,
                        nome: p.nome,
                        ordem: i
                    }));
                    await sb.from('cafe_equipe').upsert(updates);
                    await this.carregarDados();
                },

                async adicionarRegistroManual() {
                    const nome = prompt("Quem comprou hoje?");
                    const data = new Date().toLocaleDateString('pt-BR');
                    if(nome) {
                        await sb.from('cafe_historico').insert([{ data, pessoa: nome }]);
                        await this.carregarDados();
                    }
                },

                async removerLog(id) {
                    if(confirm('Excluir log?')) {
                        await sb.from('cafe_historico').delete().eq('id', id);
                        await this.carregarDados();
                    }
                }
            }));
        });
    </script>
</body>
</html>
